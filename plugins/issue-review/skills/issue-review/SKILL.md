---
name: issue-review
description: |
  系統化的問題分析專家技能，自動協調多個專門代理進行深度問題分析。

  適用於：
  - 使用者或 PM 報告的線上問題
  - 開發團隊反映的技術問題
  - 測試發現的 bug
  - 生產環境告警和異常
---

# Issue Review - 系統化問題分析

你已進入 **Issue Review 模式**，將執行系統化的問題分析工作流程。

## 工作流程

```
階段 1: 問題分析 (problem-analyzer)
   ↓
階段 2: 程式碼庫調查 (codebase-investigator)
   ↓
階段 3: 根本原因定位 (root-cause-finder) [迭代]
   ↓
階段 4: 最終報告
```

---

## 立即執行

### 步驟 1：收集問題描述

如果用戶已提供問題描述，直接進入步驟 2。

如果用戶尚未提供，請詢問：

> 請描述您要分析的問題：
> - 問題現象是什麼？
> - 發生在什麼環境？
> - 有錯誤訊息嗎？
> - 如何重現？

---

### 步驟 2：啟動 problem-analyzer

收到問題描述後，**立即使用 Task 工具**啟動 problem-analyzer 代理：

```
使用 problem-analyzer 代理執行以下任務：

分析問題描述：
[用戶提供的問題描述]

要求：
1. 提取所有已知資訊（現象、環境、重現步驟、錯誤訊息）
2. 識別資訊缺口
3. 分類問題類型和嚴重程度
4. 提出 3-5 個初步假設，按可能性排序
5. 輸出結構化的問題分析報告
```

**階段完成後**：向用戶報告「✅ 階段 1 完成：問題分析」並展示關鍵假設。

---

### 步驟 3：啟動 codebase-investigator

將 problem-analyzer 的輸出傳遞給 codebase-investigator：

```
使用 codebase-investigator 代理執行以下任務：

基於問題分析結果調查程式碼庫：
[problem-analyzer 的分析報告]

要求：
1. 定位相關程式碼進入點
2. 追蹤執行流程
3. 識別 5-7 個可能原因並評分 (0-100)
4. 提供程式碼位置和片段
5. 按可能性排序輸出
```

**階段完成後**：向用戶報告「✅ 階段 2 完成：程式碼調查」並展示可能原因列表。

---

### 步驟 4：啟動 root-cause-finder（迭代）

從最高可能性假設開始驗證：

```
使用 root-cause-finder 代理執行以下任務：

驗證假設：[假設描述]
位置：[程式碼位置]
可能性評分：[XX/100]

要求：
1. 完整閱讀相關程式碼
2. 推演執行邏輯
3. 收集證據（支持/反駁）
4. 建立因果鏈
5. 判斷：確認/部分確認/排除
```

**迭代邏輯**：
- **✅ 確認**：停止迭代，進入步驟 5
- **❓ 部分確認**：記錄，繼續驗證下一假設
- **❌ 排除**：繼續驗證下一假設
- **最多驗證 3 個假設**

**階段完成後**：向用戶報告「✅ 階段 3 完成：根本原因定位」

---

### 步驟 5：生成最終報告

生成結構化的分析報告：

```markdown
# 🎯 Issue Review 分析報告

## 執行摘要

| 項目 | 內容 |
|------|------|
| 問題 | [一句話描述] |
| Root Cause | [根本原因] |
| 位置 | `file:line` |
| 信心度 | XX% |
| 優先級 | P0/P1/P2 |

## 根本原因

### 問題位置
**檔案**：`path/to/file.ext`
**行號**：XX-YY
**函式**：`functionName()`

### 問題描述
[詳細說明問題的本質]

### 完整因果鏈
```
[根本原因]
  ↓ 導致
[中間影響]
  ↓ 導致
[直接原因]
  ↓ 表現為
[表面症狀]
```

### 程式碼分析
```[language]
// 問題程式碼
[code snippet]
```

## 修復建議

### 推薦修復
```[language]
// 修復後程式碼
[fixed code]
```

### 修復說明
[解釋修復的原因和預期效果]

## 驗證方法

1. **程式碼審查**：[驗證步驟]
2. **測試驗證**：[測試方法]
3. **監控確認**：[監控指標]

## 其他發現

### 次要問題
- [問題 1] - 優先級: P2
- [問題 2] - 優先級: P3

### 技術債務
- [債務 1]
- [債務 2]

---

**分析完成時間**：[timestamp]
**使用代理**：problem-analyzer → codebase-investigator → root-cause-finder
```

---

## 特殊情況處理

### 情況 1：資訊不足

如果問題描述過於簡短，請詢問：
- 瀏覽器開發者工具的網路/主控台截圖
- 伺服器日誌
- 詳細的重現步驟

### 情況 2：找不到確定的 Root Cause

如果所有假設都無法確認：
1. 彙總「部分確認」的假設
2. 說明需要的額外資訊
3. 提供基於當前分析的臨時建議

### 情況 3：多個 Root Causes

如果發現多個確認的原因：
1. 分別說明每個 Root Cause
2. 分析它們的關係（獨立/共同作用）
3. 提供各自的修復建議和優先級

---

## 可用命令

除了此技能，你還可以使用：

- `/analyze-issue [問題描述]` - 快速啟動完整分析流程
- `/quick-analyze [問題描述]` - 快速診斷（適用於有明確錯誤訊息的情況）

---

## 開始分析

**請提供您要分析的問題描述**，我將立即啟動系統化的分析流程。

如果您已經在上方提供了問題描述，我將直接開始分析。
