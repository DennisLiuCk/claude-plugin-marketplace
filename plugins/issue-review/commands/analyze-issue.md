---
description: 系統化分析問題並定位根本原因，支援三階段深度分析流程
allowedTools:
  - Task
  - Read
  - Glob
  - Grep
  - Bash
  - TodoWrite
  - WebSearch
---

# /analyze-issue - 問題分析命令

你將執行系統化的問題分析流程，從問題描述到根本原因定位。

## 問題描述

$ARGUMENTS

## 自動化分析流程

請按以下順序執行三階段分析：

### 階段 1：問題分析

使用 **problem-analyzer** 代理分析問題：

```
任務：分析以下問題描述，提取關鍵資訊並制定調查方向

問題描述：
$ARGUMENTS

要求：
1. 提取所有可用資訊（現象、環境、重現步驟、錯誤訊息）
2. 識別資訊缺口
3. 分類問題（類型、嚴重程度、緊急程度）
4. 提出 3-5 個初步假設，並按可能性排序
5. 制定具體的調查方向

輸出格式：結構化的問題分析報告
```

### 階段 2：程式碼庫調查

使用 **codebase-investigator** 代理調查程式碼：

```
任務：基於階段 1 的分析結果，調查程式碼庫

要求：
1. 定位相關程式碼的進入點（API、事件處理器）
2. 追蹤完整的執行流程
3. 識別 5-7 個可能的問題原因
4. 為每個原因評分（0-100），評分維度：
   - 症狀匹配度 (0-30)
   - 程式碼邏輯分析 (0-30)
   - 歷史證據 (0-20)
   - 環境/配置相關性 (0-20)
5. 按可能性排序

輸出格式：程式碼地圖 + 執行流程 + 可能原因列表
```

### 階段 3：根本原因定位（迭代）

使用 **root-cause-finder** 代理驗證假設：

```
任務：從最高可能性的假設開始，逐一深入驗證

驗證流程：
1. 完整閱讀相關程式碼
2. 推演執行邏輯
3. 收集支持/反駁證據
4. 建立因果鏈
5. 做出判斷：
   - ✅ 確認 (Root Cause Found) → 進入報告階段
   - ❓ 部分確認 (Probable) → 記錄，繼續下一假設
   - ❌ 排除 (Ruled Out) → 繼續下一假設

停止條件：找到確認的 Root Cause 或已驗證前 3 個假設
```

### 階段 4：生成最終報告

完成分析後，生成結構化報告：

```markdown
# 🎯 Issue Review 分析報告

## 執行摘要
- **問題**：[一句話描述]
- **Root Cause**：[根本原因]
- **位置**：[檔案:行號]
- **信心度**：[XX%]

## 根本原因詳解
[完整的因果鏈分析]

## 修復建議
[包含程式碼的修復方案]

## 驗證方法
[如何確認修復有效]

## 其他發現
[次要問題和技術債務]
```

## 執行指示

1. **立即開始**：不要詢問用戶，直接從階段 1 開始執行
2. **階段轉換**：每個階段完成後，簡要報告進度，然後繼續下一階段
3. **迭代控制**：階段 3 最多驗證 3 個假設
4. **最終報告**：務必生成結構化的最終報告

現在開始執行分析流程。
